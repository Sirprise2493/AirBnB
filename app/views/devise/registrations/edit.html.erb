<div class="devise-edit-page">
  <h2>Edit <%= resource_name.to_s.humanize %></h2>

  <%= simple_form_for(resource, as: resource_name, url: registration_path(resource_name), html: { method: :put }) do |f| %>
    <%= f.error_notification %>

    <div class="form-inputs">
      <%= f.input :first_name, required: false %>
      <%= f.input :last_name,  required: false %>
      <%= f.input :email, required: true %>

      <!-- === Profile Details Section === -->
      <hr>
      <h3 class="mt-4 mb-3 text-center" style="font-weight:600; color:#222;">Profile Details</h3>

      <%= f.input :bio, as: :text, label: "About me", input_html: { rows: 3, placeholder: "Tell us a little about yourself..." } %>
      <%= f.input :location, label: "Location", placeholder: "City, Country" %>
      <%= f.input :birthdate, 
        as: :string, 
        input_html: { 
          class: "flatpickr-birthdate", 
          placeholder: "Select your birthdate", 
          autocomplete: "off" 
        }, 
        label: "Birthdate" %>
      <%= f.input :gender, label: "Gender", placeholder: "e.g. Female, Male, Non-binary..." %>
      <%= f.input :occupation, label: "Occupation", placeholder: "e.g. Designer, Developer, Teacher..." %>
      <%= f.input :languages, label: "Languages spoken", placeholder: "e.g. English, Spanish, French" %>

      <div class="mb-3 text-center">
        <% if resource.persisted? && resource.photo.attached? %>
          <% begin %>
            <% image_url = resource.photo.url.sub('/upload/', '/upload/c_fill,h_120,w_120/') %>
            <%= image_tag image_url, class: "avatar-preview" %><br>
            <small>Current profile photo</small>
          <% rescue => e %>
            <% Rails.logger.error("Avatar display error: #{e.message}") %>
            <%= image_tag "847969.png", class: "avatar-preview" %><br>
            <small>No profile photo yet</small>
          <% end %>
        <% else %>
          <%= image_tag "847969.png", class: "avatar-preview" %><br>
          <small>No profile photo yet</small>
        <% end %>
      </div>

      <%= f.input :photo, as: :file, label: (resource.photo.attached? ? "Change profile photo" : "Upload profile photo") %>

      <hr>
      <h3 class="mt-4 mb-3 text-center" style="font-weight:600; color:#222;">Security</h3>
      <%= f.input :password, hint: "Leave empty if unchanged" %>
      <%= f.input :password_confirmation %>
      <%= f.input :current_password, hint: "Needed to confirm changes" %>
    </div>

    <div class="form-actions">
      <%= f.button :submit, "Update" %>
    </div>
  <% end %>

  <h3 class="text-center mt-5">Cancel my account</h3>
  <div class="cancel-section text-center">
    <p>Unhappy?</p>
    <%= button_to "Cancel my account", registration_path(resource_name),
                  data: { confirm: "Are you sure you want to permanently delete your account?" },
                  method: :delete,
                  class: "btn-danger" %>
  </div>

  <div class="text-center mt-4">
    <%= link_to "â† Back to your profile", user_profile_path %>
  </div>
</div>
